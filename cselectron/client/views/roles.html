<!DOCTYPE html>
<html lang="en">
<head>
  <title>Management System</title>
  <link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css' />
  <link rel='stylesheet' href='../public/css/theme.css' />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Two+Tone|Material+Icons+Round|Material+Icons+Sharp" rel="stylesheet">
</head>
<body style="background-color: transparent;">
    <div class="bg" style="border-radius:8px;">

    
        <div class="outsidecontainer">
            <div style="-webkit-app-region: drag;position:absolute;width:100%;top:0;left:50%;transform:translateX(-50%);-webkit-transform: translateX(-50%);height:10%;">

            </div>
            <div class="centercontainer" style="height:80%;width:90%;text-align: center;">
            <span style="text-align: center;color:white;font-size: 40px;font-weight: 600;display:inline-block">Welcome!</span><br/>
            <span style="text-align: center;color:white;font-size: 20px;font-weight: 600;display:inline-block">Please Select a Role</span>
            <br/>
            <br/>
            <div id="roleList" style="height:75%;overflow-y:auto;width:100%;padding:5px">

            </div>
            
            
            </div>
            
            <div class="statuscontainer">
            <div style="display: flex;">
                
                <div class="elevatedframe" style="display: inline-block;margin-right: 12px;padding-top: 8px;padding-bottom: 8px;">
                <span style="text-align: center;color:white;font-size: 15px;font-weight: 600;display:inline-block">Act 1</span>
                </div>
                <div class="elevatedframe" style="display: inline-block;padding-top: 8px;padding-bottom: 8px;margin-right: 12px;">
                <span style="text-align: center;color:white;font-size: 15px;font-weight: 600;display:inline-block;margin-right: 5px;">Choosing Role</span>
                <span style="height: 10px;width: 10px;background-color: #828282;display: inline-block;border-radius: 50%;" title="You Are Not Online!"></span>
                
                </div>
                <input style="display:inline-block;text-align: center;border-radius: 20px;font-size: 15px;padding: 8px 15px 8px 15px;" class="elevatedbutton" id="closeApp" type="button" value="Exit App"/>
            </div>
            
            </div>
        </div>
    </div>
  

  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
</body>
<script src="../vendor/howler/dist/howler.js"></script>
<script>

  /*
  Title: ElectronJS
  Author: OpenJS Foundation
  Date: 2/12/2021
  Code Version: 4.2.12
  Code Availaibility: https://www.electronjs.org/
  Notes: This is the library that brings the HTML page to life in a new window instead of the Chrome browser. All content that shows up inside the window is not within Electron's control, and is completely coded by this project's author
*/
  const {ipcRenderer} = require('electron');
var allRoles = [];

    function openMainWindow(event){
      
        ipcRenderer.send('selectRole', { 'role' : event.srcElement.id, 'password' : document.getElementById(event.srcElement.id + "|password").value })
    }
  ipcRenderer.on("rolesToSelect", (event,args) => {
    args['roles'].forEach(role => {
      allRoles.push(role)
    });
    allRoles.forEach(role => {
        document.getElementById("roleList").innerHTML = document.getElementById("roleList").innerHTML + `<div class="elevatedframe" style="display: flex;width:100%;text-align:left;align-items: center">
          
          <span style="text-align: left;color:white;font-size: 18px;font-weight: 600;display:inline-flex;margin-right: 20px;margin-left: 5px;overflow:hidden;vertical-align:middle;white-space: nowrap;text-overflow: ellipsis;flex-grow: 1;">${role.prettyName} ${role.password ? '<span class="material-icons-round iconbutton download" style="font-size:24px;vertical-align:middle;margin-left:5px;text-align:right;">security</span>' : ''}</span>
          ${role.currentlyConnected >= role.max && role.max != -1 ? `<span style="cursor:not-allowed;text-align: right;color:white;font-size: 14px;font-weight: 600;display:inline-flex;margin-right: 10px;overflow:hidden;vertical-align:middle;white-space: nowrap;text-overflow: ellipsis;">Role Filled</span><span class="material-icons-round iconbutton download" style="cursor:not-allowed;font-size:24px;vertical-align:middle;margin-right:5px;text-align:right;display: inline-flex;margin-top:7px;margin-bottom:7px">lock</span>` : `<input type="password" class="textbox autoenter" style="font-size:16px;vertical-align:middle;width:20%;${role.password ? 'display:inline-flex' : 'display:none'}" placeholder="Password" id="${role.identifier}|password"/>
          <span class="elevatedbutton thissong" style="font-size:12px;display: inline-flex;vertical-align:middle;margin-left:10px" id="${role.identifier}">Sign In</span>`}
          
        </div><br/>`
        
    });

    /*
      Title: Detect Enter keyup
      Author: Gibolt
      Date: 5/3/21
      Source: https://stackoverflow.com/questions/7060750/detect-the-enter-key-in-a-text-input-field
     */
    Array.from(document.getElementsByClassName("thissong")).forEach(btn => {
      btn.addEventListener("click", openMainWindow)
    })
    const nodes = document.getElementsByClassName("autoenter");
    Array.from(nodes).forEach(el => {
      el.addEventListener("keyup", function(event) {
        if (event.key === "Enter") {
          // -8 for password
          var roleId = event.srcElement.id.split("|")[0]
          ipcRenderer.send('selectRole', { 'role' : roleId, 'password' : document.getElementById(roleId + "|password").value })
        }
      });
    })
  });
  ipcRenderer.on("passwordFail", (event, args) => {
    document.getElementById(args["role"] + "|password").style.borderColor = "#ff6b8b"
    //document.getElementById(args["role"]).style.color = "#ff6b8b"
    document.getElementById(args["role"] + "|password").value = ""
    document.getElementById(args["role"] + "|password").placeholder = "Invalid Pass"
    setTimeout(function(){
      document.getElementById(args["role"] + "|password").style.borderColor = ""
      document.getElementById(args["role"] + "|password").placeholder = "Password"
      //document.getElementById(args["role"]).style.color = ""
    }, 5000);
  });
  
  const closeApp = document.getElementById('closeApp');
  closeApp.addEventListener('click', () => {
    ipcRenderer.send('quitapp');
  });
</script>

</html>
