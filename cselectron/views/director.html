<!DOCTYPE html>
<html lang="en">
<head>
  <title>Management System</title>
  <link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css' />
  <link rel='stylesheet' href='../public/css/theme.css' />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
  <link href="https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Two+Tone|Material+Icons+Round|Material+Icons+Sharp" rel="stylesheet">
</head>
<body class="bg">
  <div class="outsidecontainer">
    <div class="leftcontainer" style="height:80%">
      <div id="instanceList">
        
      </div>
      
      
    </div>
    <div class="rightcontainer" style="left:60%;width:35%">
      
      
      
    </div>
    <div class="statuscontainer">
      <div style="display: flex;">
        
        <div class="elevatedframe" style="display: inline-block;margin-right: 12px;padding-top: 8px;padding-bottom: 8px;">
          <span style="text-align: center;color:white;font-size: 15px;font-weight: 600;display:inline-block">Act 1</span>
        </div>
        <div class="elevatedframe" style="display: inline-block;padding-top: 8px;padding-bottom: 8px;margin-right: 12px;">
          <span style="text-align: center;color:white;font-size: 15px;font-weight: 600;display:inline-block;margin-right: 5px;">Schema Designer</span>
          <span style="height: 10px;width: 10px;background-color: green;display: inline-block;border-radius: 50%;" title="You Are Online!"></span>
          
        </div>
        <input style="display:inline-block;text-align: center;border-radius: 20px;font-size: 15px;padding: 8px 15px 8px 15px;" class="elevatedbutton" id="closeApp" type="button" value="Exit App"/>
      </div>
      
    </div>
    
  <div id="deletePhase" class="overlayBox" style="display:none;text-align:center;">
    <div style="width:100%;height:100%;display: flex;align-items:center;justify-content:center">
      <div class="elevatedframe" style="display:inline-block;padding:30px;max-width:500px">
        <input style="display: none;" id="selected_removePhase" value=""/>
        <span style="color: white;font-size:20px;font-weight:600;margin-bottom: 5px;display:block">Are you sure?</span>
        <span style="color: white;font-size:12px;margin-bottom: 10px;display:block">You are about to permanately delete a phase and the order of the songs inside it.</span>
        <input style="display:inline-block;text-align: center;font-size: 15px;padding: 8px 15px 8px 15px;margin-left:10px;vertical-align: middle;margin-top: 5px;" class="elevatedbutton" id="cancel_removePhase" type="button" value="Cancel"/>
        <input style="display:inline-block;text-align: center;font-size: 15px;padding: 8px 15px 8px 15px;margin-left:10px;vertical-align: middle;" class="elevatedbutton" id="delete_removePhase" type="button" value="Delete"/>
      </div>
    </div>
    
  </div>
</body>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
<script src="../vendor/howler/dist/howler.js"></script>
<script>

  instances = []

  function askDelete(evt){
    var phaseId = evt.srcElement.id.split("_")[0] + "_" + evt.srcElement.id.split("_")[1] + "_" + evt.srcElement.id.split("_")[2]
    var phaseObject = phases.filter(el => el.id == phaseId)[0]
    document.getElementById("selected_removePhase").value = phaseId;
    document.getElementById("deletePhase").style.display = "";
  }

  function cancelDelete(){
    document.getElementById("selected_removePhase").value = "";
    document.getElementById("deletePhase").style.display = "none";
  }

  function confirmDelete(){
    var phaseId = document.getElementById("selected_removePhase").value
    var phaseObject = phases.filter(el => el.id == phaseId)[0]
    delete phases[phases.indexOf(phaseObject)]
    document.getElementById(phaseId).remove();
    document.getElementById("deletePhase").style.display = "none";
    somethingWasChanged();
  }



  const {ipcRenderer} = require('electron');


  

  ipcRenderer.on("songsToLoad", (event,args) => {
    // rename to songSchema soon
    var songList = args['songs']['tracks']
    var phaseCreationIndex = 0
    songList.forEach(track => {
      console.log(track)
      document.getElementById("phaseList").innerHTML = document.getElementById("phaseList").innerHTML + `<div style="margin-top:20px;margin-bottom:20px" id="ld_phase_` + phaseCreationIndex + `">
          <div style="display:flex; flex-direction: row; align-items: center;margin-top:5px" class="topDivForPhase">
            <input class="textbox" style="display:inline-block;font-size:20px" value="` + track["trackName"] + `" placeholder="Name Me!" id="ld_phase_` + phaseCreationIndex + `_name"/>
            <span class="material-icons-round iconbutton" title="There are stricter rules enforced during the show. Click me to turn them off!" style="text-align: center;color:white;font-size: 25px;${track["strict"] ? 'inline-block' : 'none'};margin-left:10px" id="ld_phase_` + phaseCreationIndex + `_strict_on">shield</span>
            <span class="material-icons-round iconbutton" title="There are less rules enforced during the show. Click me to turn stricter ones on!" style="text-align: center;color:white;font-size: 25px;display:${!track["strict"] ? 'inline-block' : 'none'};margin-left:10px" id="ld_phase_` + phaseCreationIndex + `_strict_off">remove_moderator</span>
            <span class="material-icons-round iconbutton" title="Everyone can see this phase and add notes to it! Click me to hide this phase!" style="text-align: center;color:white;font-size: 25px;display:${track["visible"] ? 'inline-block' : 'none'};margin-left:5px" id="ld_phase_` + phaseCreationIndex + `_visible_on">visibility</span>
            <span class="material-icons-round iconbutton" title="No one but you can see this phase. Click me to make this phase public!" style="text-align: center;color:white;font-size: 25px;display:${!track["visible"] ? 'inline-block' : 'none'};margin-left:5px" id="ld_phase_` + phaseCreationIndex + `_visible_off">visibility_off</span>
            <span class="material-icons-round iconbutton" title="Duplicate me!" style="text-align: center;color:white;font-size: 25px;display:inline-block;margin-left:5px" id="ld_phase_` + phaseCreationIndex + `_duplicate">content_copy</span>
            <span class="material-icons-round iconbutton" title="Delete me!" style="text-align: center;color:#ffa3b9;font-size: 25px;display:inline-block;margin-left:5px" id="ld_phase_` + phaseCreationIndex + `_removePhase">delete</span>
            
          </div>
          <br/>
          <div style="border-left: 2px solid white;border-radius:4px;margin-bottom:5px">
            <div style="margin-left:15px" id="ld_phase_` + phaseCreationIndex + `_sort" style="min-height: 200px">

            </div>
          </div>
        </div>`
        
      phases.push(new Phase("ld_phase_" + phaseCreationIndex, track["trackName"], track["visible"], track["strict"], 0));
      track["trackSongs"].forEach(song => {
        
        if(defaultSongs.filter(el => el.name == song["songName"]).length > 0){
          console.log(song)
          document.getElementById("ld_phase_" + phaseCreationIndex + "_sort").innerHTML = document.getElementById("ld_phase_" + phaseCreationIndex + "_sort").innerHTML + `<div class="elevatedframe" data-song="song_${song["songName"] + "." + song["fileType"]}" style="width:70%;margin-bottom: 5px;">
            <div style="display: table;width:100%;">
              <span style="text-align: left;color:white;font-size: 18px;font-weight: 600;display:table-cell;margin-right: 20px;overflow:hidden;vertical-align:middle;white-space: nowrap;text-overflow: ellipsis;">${song["songName"]}</span>
              <span class="material-icons-round iconbutton download deleteThisSong" style="font-size:24px;display: table-cell;vertical-align:middle;margin-right:5px;text-align:right;width:7%">close</span>
            </div>
          </div>`
        }else{
          console.log("We are unable to load the song " + song["songName"] + "." + song["fileType"] + " as it is not in the system.")
        }
        
      });
      phaseCreationIndex = phaseCreationIndex + 1
      
    });

    
    Array.from(document.getElementsByClassName("deleteThisSong")).forEach(el => {
      el.addEventListener('click', deleteThisSong);
    });
  });

  
  ipcRenderer.on('notesToLoad', (event,args) => {
    //args["roleNotes"].forEach(el => {
    //  console.log(el)
    //});
    
    
  });
  ipcRenderer.on('instancesSent', (event, args) => {
    var passedDownInstances = JSON.parse(args['rawJson'])
    var mySocketId = args['mySocketId']
    passedDownInstances.forEach(el => {
        document.getElementById("instanceList").innerHTML = document.getElementById("instanceList").innerHTML + `
        <div class="elevatedframe" style="display: table;width:95%" id="${el.socketId}_frame">
          <span class="material-icons-round iconbutton thissong" style="font-size:24px;display: table-cell;vertical-align:middle;width:7%">play_arrow</span>
          <div style="display:table-cell">
            <span style="text-align: left;color:white;font-size: 18px;font-weight: 600;margin-right: 20px;overflow:hidden;vertical-align:middle;max-width:70%;white-space: nowrap;text-overflow: ellipsis;display:block" id="${el.socketId}_roleName">${el.role.prettyName + (el.deviceId == mySocketId ? " (You)" : "")}</span>
            <span style="text-align: left;color:white;font-size: 12px;font-weight: 600;margin-right: 20px;overflow:hidden;vertical-align:middle;max-width:70%;white-space: nowrap;text-overflow: ellipsis;display:block" id="${el.socketId}_name">${el.deviceId}</span>
          </div>
          
          <span class="material-icons-round iconbutton download" style="font-size:24px;display: table-cell;vertical-align:middle;margin-right:5px;text-align:right;width:7%">cloud_download</span>
        </div><br/>
        `
    });
  });

    ipcRenderer.on('instancesUpdate', (event, args) => {
        var instanceChanges = JSON.parse(args['rawJson'])
        var mySocketId = args['mySocketId']
        instanceChanges.forEach(ci => {
            if(ci.change == "update"){

            }else if(ci.change == "delete"){

            }else if(ci.change == "create"){
                
            }
        });
    });

  ipcRenderer.send("getInstanceList")
  ipcRenderer.send("getNotes")
  const closeApp = document.getElementById('closeApp');
  closeApp.addEventListener('click', () => {
    ipcRenderer.send('quitapp');
  });
</script>

</html>
